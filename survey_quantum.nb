(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     83401,       2083]
NotebookOptionsPosition[     80845,       2032]
NotebookOutlinePosition[     81274,       2049]
CellTagsIndexPosition[     81231,       2046]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Basic data import & manipulation", "Subsection",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.},
 InitializationCell->True,
 CellChangeTimes->{{3.8079522928774014`*^9, 3.807952305405203*^9}, 
   3.8079524201575603`*^9, 
   3.808039133010038*^9},ExpressionUUID->"1a9ea465-87d2-4182-9479-\
db041d969011"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{"False", ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"messageHandler", "=", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Last", "[", "#", "]"}], ",", 
         RowBox[{"Abort", "[", "]"}]}], "]"}], "&"}]}], " ", ";", 
     RowBox[{"Internal`AddHandler", "[", 
      RowBox[{"\"\<Message\>\"", ",", "messageHandler"}], "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"classicdatapath", "=", 
    RowBox[{"FileNameJoin", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<surveydata\>\"", ",", "\"\<classical\>\""}], "}"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Import", " ", "NPY", " ", "array", " ", "as", " ", "List"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ImportNPY", "[", "file_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"a", ",", 
        RowBox[{"f", "=", 
         RowBox[{"OpenRead", "[", 
          RowBox[{"file", ",", 
           RowBox[{"BinaryFormat", "\[Rule]", "True"}]}], "]"}]}], ",", 
        "version", ",", "headerlen", ",", "header", ",", "dims", ",", "type", 
        ",", "typ", ",", "byto"}], "}"}], ",", 
      RowBox[{
       RowBox[{"a", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"BinaryRead", "[", 
             RowBox[{"f", ",", "\"\<Byte\>\""}], "]"}], "\[Equal]", "147"}], "&&", 
           RowBox[{
            RowBox[{"BinaryReadList", "[", 
             RowBox[{"f", ",", "\"\<Character8\>\"", ",", "5"}], "]"}], 
            "\[Equal]", 
            RowBox[{"Characters", "[", "\"\<NUMPY\>\"", "]"}]}]}], ",", 
          RowBox[{
           RowBox[{"version", "=", 
            RowBox[{"BinaryReadList", "[", 
             RowBox[{"f", ",", "\"\<Byte\>\"", ",", "2"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"headerlen", "=", 
            RowBox[{"BinaryRead", "[", 
             RowBox[{"f", ",", "\"\<Integer16\>\"", ",", 
              RowBox[{"ByteOrdering", "\[Rule]", 
               RowBox[{"-", "1"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"header", "=", 
            RowBox[{"StringJoin", "@", 
             RowBox[{"BinaryReadList", "[", 
              RowBox[{"f", ",", "\"\<Character8\>\"", ",", "headerlen"}], 
              "]"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"dims", "=", 
            RowBox[{
             RowBox[{"StringCases", "[", 
              RowBox[{"header", ",", 
               RowBox[{
                RowBox[{
                "\"\<'shape':\>\"", "~~", "Whitespace", "~~", "\"\<(\>\"", "~~", 
                 RowBox[{"s", ":", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    "NumberString", ",", "\"\<,\>\"", ",", "Whitespace"}], 
                    "}"}], ".."}]}], "~~", "\"\<)\>\""}], "\[RuleDelayed]", 
                RowBox[{"ToExpression", "[", 
                 RowBox[{"\"\<{\>\"", "~~", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"StringTake", "[", 
                    RowBox[{"s", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "\[Equal]", "\"\<,\>\""}], 
                    ",", 
                    RowBox[{"StringDrop", "[", 
                    RowBox[{"s", ",", 
                    RowBox[{"-", "1"}]}], "]"}], ",", "s"}], "]"}], "~~", 
                  "\"\<}\>\""}], "]"}]}]}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"type", "=", 
            RowBox[{
             RowBox[{"StringCases", "[", 
              RowBox[{"header", ",", 
               RowBox[{
                RowBox[{"\"\<'descr':\>\"", "~~", "Whitespace", "~~", 
                 RowBox[{"Shortest", "[", 
                  RowBox[{"\"\<'\>\"", "~~", 
                   RowBox[{"s", ":", 
                    RowBox[{"_", "..."}]}], "~~", "\"\<'\>\""}], "]"}]}], 
                "\[RuleDelayed]", "s"}]}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"byto", "=", 
            RowBox[{"Switch", "[", 
             RowBox[{
              RowBox[{"StringTake", "[", 
               RowBox[{"type", ",", "1"}], "]"}], ",", "\"\<<\>\"", ",", 
              RowBox[{"-", "1"}], ",", "\"\<>\>\"", ",", "1", ",", "_", ",", 
              "$ByteOrdering"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "\"\<<\>\"", ",", "\"\<>\>\"", ",", "\"\<|\>\"", ",", 
                 "\"\<=\>\""}], "}"}], ",", 
               RowBox[{"StringTake", "[", 
                RowBox[{"type", ",", "1"}], "]"}]}], "]"}], ",", 
             RowBox[{"type", "=", 
              RowBox[{"StringDrop", "[", 
               RowBox[{"type", ",", "1"}], "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"typ", "=", 
            RowBox[{"Switch", "[", 
             RowBox[{
             "type", ",", "\"\<f8\>\"", ",", "\"\<Real64\>\"", ",", 
              "\"\<i8\>\"", ",", "\"\<Integer64\>\"", ",", "_", ",", 
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{"\"\<unknown type\>\"", ",", "header"}], "]"}], ";", 
               "0"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"typ", "\[NotEqual]", "0"}], ",", 
             RowBox[{"ArrayReshape", "[", 
              RowBox[{
               RowBox[{"BinaryReadList", "[", 
                RowBox[{"f", ",", "typ", ",", 
                 RowBox[{"ByteOrdering", "\[Rule]", "byto"}]}], "]"}], ",", 
               "dims"}], "]"}], ",", "0"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<not a npy\>\"", "]"}], ";", "0"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Close", "[", "f", "]"}], ";", "a"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
     "Imports", " ", "results", " ", "of", " ", "optimization", " ", "for", 
      " ", "sequences", " ", "of", " ", "length", " ", "l", " ", "and", " ", 
      "dimension", " ", "d"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Outputs", " ", "a", " ", "list", " ", 
      StyleBox["data",
       FontSlant->"Italic"], " ", "such", " ", 
      RowBox[{"that", ":", "\[IndentingNewLine]", 
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "1"}], "]"}], "]"}], ":", " ", 
       RowBox[{"i", "-", 
        RowBox[{"th", " ", "sequence", " ", "number", " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"0", " ", "=", " ", 
            RowBox[{
             RowBox[{"00", "..."}], "00"}]}], ",", " ", 
           RowBox[{"1", " ", "=", " ", 
            RowBox[{
             RowBox[{"00", "..."}], "01"}]}], ",", " ", 
           RowBox[{"2", " ", "=", " ", 
            RowBox[{
             RowBox[{"00", "..."}], "10"}]}], ",", " ", 
           RowBox[{"etc", "."}]}], ")"}]}]}], ":", "\[IndentingNewLine]", 
       RowBox[{"data", "[", 
        RowBox[{"[", 
         RowBox[{"i", ",", "2"}], "]"}], "]"}], ":", " ", 
       RowBox[{"i", "-", 
        RowBox[{
        "th", " ", "sequence", " ", "as", " ", "a", " ", "pattern"}]}]}]}]}], 
    ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"a", " ", "list", " ", "such", " ", "as", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1", ",", "0", ",", "1", ",", "1"}], "}"}], 
        "\[IndentingNewLine]", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "3"}], "]"}], "]"}]}], ":", " ", 
       RowBox[{"the", " ", "best", " ", 
        RowBox[{"proViewSequence", "[", "seq_", "]"}]}]}], ":=", 
      RowBox[{"ArrayPlot", "[", 
       RowBox[{
        RowBox[{"{", "seq", "}"}], ",", 
        RowBox[{"ColorRules", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"0", "\[Rule]", 
            RowBox[{"Hue", "[", 
             RowBox[{"0", ",", "0", ",", "0.9"}], "]"}]}], ",", 
           RowBox[{"1", "\[Rule]", "Black"}]}], "}"}]}], ",", 
        RowBox[{"Mesh", "\[Rule]", "All"}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "100"}], ",", 
        RowBox[{"Frame", "\[Rule]", "None"}]}], "]"}]}], ";", 
     RowBox[{
     "bability", " ", "encountered", " ", "via", " ", "optimization", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"(", 
       RowBox[{"The", " ", "files", " ", "results", "*", 
        RowBox[{".", "txt"}], " ", "contain", " ", "redundant", " ", 
        "information", " ", "so", " ", "they", " ", "are", " ", "legible", 
        " ", "directly"}], ")"}]}]}]}], "\[IndentingNewLine]", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ImportResults", "[", 
     RowBox[{"l_", ",", "d_", ",", 
      RowBox[{"s_", ":", "2"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"fn", ",", "dat"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fn", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"NotebookDirectory", "[", "]"}], ",", "classicdatapath", 
           ",", 
           RowBox[{"\"\<results_S\>\"", "<>", 
            RowBox[{"ToString", "[", "s", "]"}], "<>", "\"\<_L\>\"", "<>", 
            RowBox[{"StringPadLeft", "[", 
             RowBox[{
              RowBox[{"ToString", "[", "l", "]"}], ",", "2", ",", 
              "\"\<0\>\""}], "]"}], "<>", "\"\<_D\>\"", "<>", 
            RowBox[{"StringPadLeft", "[", 
             RowBox[{
              RowBox[{"ToString", "[", "d", "]"}], ",", "2", ",", 
              "\"\<0\>\""}], "]"}], "<>", "\"\<.txt\>\""}]}], "}"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FileExistsQ", "[", "fn", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"dat", "=", 
           RowBox[{"Import", "[", 
            RowBox[{"fn", ",", "\"\<Table\>\""}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"dat", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{
             RowBox[{"IntegerDigits", "[", 
              RowBox[{"#", ",", "2", ",", "l"}], "]"}], "&"}], "/@", 
            RowBox[{"dat", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", "dat"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<No data for \>\"", "<>", 
            RowBox[{"FileBaseName", "[", "fn", "]"}], "<>", "\"\<.txt\>\""}], 
           "]"}], ";", " ", 
          RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
     "Import", " ", "NPY", " ", "model", " ", "tensor", " ", "for", " ", "a", 
      " ", "given", " ", "sequence", " ", "seq", " ", "with", " ", 
      "dimension", " ", "d", " ", "and", " ", "s", " ", "symbols"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Returns", " ", "a", " ", 
      RowBox[{"s", "\[Cross]", "d", "\[Cross]", "d"}], " ", "tensor", " ", 
      "T", " ", "as", " ", "a", " ", "list"}]}], ",", " ", 
    RowBox[{
     RowBox[{"so", " ", "that", " ", "T0"}], " ", "=", " ", 
     RowBox[{"T", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ImportTModel", "[", 
    RowBox[{"seq0_", ",", 
     RowBox[{"d_", ":", "2"}], ",", 
     RowBox[{"s_", ":", "2"}]}], "]"}], ":=", 
   RowBox[{"Quiet", "@", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"t", ",", "i", ",", "l", ",", "fn", ",", "seq"}], "}"}], ",", 
      RowBox[{
       RowBox[{"l", "=", 
        RowBox[{"Length", "[", "seq0", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"seq", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"seq0", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "1"}], ",", 
          RowBox[{"1", "-", "seq0"}], ",", "seq0"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fn", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"NotebookDirectory", "[", "]"}], ",", "classicdatapath", 
           ",", 
           RowBox[{"\"\<T_S\>\"", "<>", 
            RowBox[{"ToString", "[", "s", "]"}], "<>", "\"\<_L\>\"", "<>", 
            RowBox[{"StringPadLeft", "[", 
             RowBox[{
              RowBox[{"ToString", "[", "l", "]"}], ",", "2", ",", 
              "\"\<0\>\""}], "]"}], "<>", "\"\<_D\>\"", "<>", 
            RowBox[{"StringPadLeft", "[", 
             RowBox[{
              RowBox[{"ToString", "[", 
               RowBox[{"Max", "[", 
                RowBox[{"1", ",", "d"}], "]"}], "]"}], ",", "2", ",", 
              "\"\<0\>\""}], "]"}], "<>", "\"\<_\>\"", "<>", 
            RowBox[{"Map", "[", 
             RowBox[{"ToString", ",", "seq"}], "]"}], "<>", 
            "\"\<.npy\>\""}]}], "}"}], "]"}]}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"FileExistsQ", "[", "fn", "]"}], ",", 
         RowBox[{
          RowBox[{"t", "=", 
           RowBox[{"ImportNPY", "[", "fn", "]"}]}], ";", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "1"}], ",", 
            RowBox[{"i", "\[LessEqual]", "d"}], ",", 
            RowBox[{"i", "++"}], ",", 
            RowBox[{
             RowBox[{"t", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "i", ",", "All"}], "]"}], "]"}], "/=", 
             RowBox[{"Total", "@", 
              RowBox[{"Flatten", "[", 
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "i", ",", "All"}], "]"}], "]"}], 
               "]"}]}]}]}], "]"}], ";", "t"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<No data for \>\"", "<>", 
            RowBox[{"FileBaseName", "[", "fn", "]"}], "<>", "\"\<.txt\>\""}], 
           "]"}], ";", 
          RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}]}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ImportTModelAbsolute", "[", 
     RowBox[{"path_", ",", "seq0_", ",", 
      RowBox[{"d_", ":", "2"}], ",", 
      RowBox[{"s_", ":", "2"}]}], "]"}], ":=", 
    RowBox[{"Quiet", "@", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"t", ",", "i", ",", "l", ",", "fn", ",", "seq"}], "}"}], ",", 
       RowBox[{
        RowBox[{"l", "=", 
         RowBox[{"Length", "[", "seq0", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"seq", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"seq0", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "1"}], ",", 
           RowBox[{"1", "-", "seq0"}], ",", "seq0"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"fn", "=", 
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{"path", ",", "classicdatapath", ",", 
            RowBox[{"\"\<T_S\>\"", "<>", 
             RowBox[{"ToString", "[", "s", "]"}], "<>", "\"\<_L\>\"", "<>", 
             RowBox[{"StringPadLeft", "[", 
              RowBox[{
               RowBox[{"ToString", "[", "l", "]"}], ",", "2", ",", 
               "\"\<0\>\""}], "]"}], "<>", "\"\<_D\>\"", "<>", 
             RowBox[{"StringPadLeft", "[", 
              RowBox[{
               RowBox[{"ToString", "[", 
                RowBox[{"Max", "[", 
                 RowBox[{"1", ",", "d"}], "]"}], "]"}], ",", "2", ",", 
               "\"\<0\>\""}], "]"}], "<>", "\"\<_\>\"", "<>", 
             RowBox[{"Map", "[", 
              RowBox[{"ToString", ",", "seq"}], "]"}], "<>", 
             "\"\<.npy\>\""}]}], "}"}], "]"}]}], ";", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"FileExistsQ", "[", "fn", "]"}], ",", 
          RowBox[{
           RowBox[{"t", "=", 
            RowBox[{"ImportNPY", "[", "fn", "]"}]}], ";", 
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"i", "=", "1"}], ",", 
             RowBox[{"i", "\[LessEqual]", "d"}], ",", 
             RowBox[{"i", "++"}], ",", 
             RowBox[{
              RowBox[{"t", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "i", ",", "All"}], "]"}], "]"}], "/=", 
              RowBox[{"Total", "@", 
               RowBox[{"Flatten", "[", 
                RowBox[{"t", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "i", ",", "All"}], "]"}], "]"}], 
                "]"}]}]}]}], "]"}], ";", "t"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<No data for \>\"", "<>", 
             RowBox[{"FileBaseName", "[", "fn", "]"}], "<>", "\"\<.txt\>\""}],
             "]"}], ";", 
           RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}]}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Given", " ", "a", " ", "model", " ", "and", " ", "a", " ", "sequence"}], 
    ",", " ", 
    RowBox[{"compute", " ", "total", " ", 
     RowBox[{"probability", "."}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ComputeProbability", "[", 
     RowBox[{"t_", ",", "seq_", ",", 
      RowBox[{"trunc_", ":", 
       RowBox[{"-", "1"}]}], ",", 
      RowBox[{"initial_", ":", "1"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d", ",", "vpi", ",", "veta"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"d", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "t", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vpi", "=", 
        RowBox[{"{", 
         RowBox[{"Map", "[", 
          RowBox[{"KroneckerDelta", ",", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"1", ",", "d"}], "]"}], "-", "initial"}]}], "]"}], 
         "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"veta", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"1", ",", 
          RowBox[{"{", 
           RowBox[{"d", ",", "1"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Det", "[", 
        RowBox[{"vpi", ".", 
         RowBox[{"(", 
          RowBox[{"Dot", "@@", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{"Join", "@@", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"IdentityMatrix", "[", 
                 RowBox[{
                  RowBox[{"Dimensions", "[", "t", "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "]"}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"t", "[", 
                  RowBox[{"[", 
                   RowBox[{"#", "+", "1"}], "]"}], "]"}], "&"}], "/@", 
                RowBox[{"Take", "[", 
                 RowBox[{"seq", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"trunc", "<", "0"}], ",", 
                    RowBox[{"Length", "[", "seq", "]"}], ",", "trunc"}], 
                   "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "}"}]}], 
            "\[IndentingNewLine]", ")"}]}], ")"}], ".", "veta"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Same", " ", "as", " ", "above"}], ",", " ", 
    RowBox[{"but", " ", 
     RowBox[{"don", "'"}], "t", " ", "multiply", " ", "by", " ", "eta"}]}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ComputeProbabilityVector", "[", 
     RowBox[{"t_", ",", "seq_", ",", 
      RowBox[{"trunc_", ":", 
       RowBox[{"-", "1"}]}], ",", 
      RowBox[{"initial_", ":", "1"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d", ",", "vpi", ",", "veta"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"d", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "t", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vpi", "=", 
        RowBox[{"{", 
         RowBox[{"Map", "[", 
          RowBox[{"KroneckerDelta", ",", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"1", ",", "d"}], "]"}], "-", "initial"}]}], "]"}], 
         "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"veta", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"1", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Dimensions", "[", "t", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Flatten", "[", 
        RowBox[{"vpi", ".", 
         RowBox[{"(", 
          RowBox[{"Dot", "@@", 
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{"Join", "@@", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"IdentityMatrix", "[", 
                 RowBox[{
                  RowBox[{"Dimensions", "[", "t", "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "]"}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"t", "[", 
                  RowBox[{"[", 
                   RowBox[{"#", "+", "1"}], "]"}], "]"}], "&"}], "/@", 
                RowBox[{"Take", "[", 
                 RowBox[{"seq", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"trunc", "<", "0"}], ",", 
                    RowBox[{"Length", "[", "seq", "]"}], ",", "trunc"}], 
                   "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "}"}]}], 
            "\[IndentingNewLine]", ")"}]}], ")"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Rearranges", " ", "the", " ", "states", " ", "in", " ", "a", " ", "model",
     " ", "into", " ", "a", " ", "canonical", " ", 
    RowBox[{"form", ".", " ", "See"}], " ", "section", " ", "1", " ", "for", 
    " ", "the", " ", 
    RowBox[{"description", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Requires", " ", "the", " ", "model", " ", "and", " ", "its", " ", 
    "sequence", " ", "it", " ", "optimizes"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CanonicalOrder", "[", 
     RowBox[{"t0_", ",", "seq_", ",", 
      RowBox[{"initial_", ":", "1"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d", ",", "ev", ",", "i", ",", "o", ",", "p"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"d", "=", 
        RowBox[{
         RowBox[{"Dimensions", "[", "t0", "]"}], "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ev", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ComputeProbabilityVector", "[", 
             RowBox[{"t0", ",", "seq", ",", "#", ",", "initial"}], "]"}], 
            "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"0", ",", 
             RowBox[{"Length", "[", "seq", "]"}]}], "]"}]}], ",", 
          RowBox[{"10.0", "^", 
           RowBox[{"-", "6"}]}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "sequence", " ", "of", " ", "probability", " ", "vectors", " ", 
          "for", " ", "0"}], "-", 
         RowBox[{"L", " ", "steps"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"o", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"ev", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "#"}], "]"}], "]"}], ",", 
            RowBox[{"_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"#", ">", "0"}], "&"}], ")"}]}], ",", "1", ",", "1"}], 
           "]"}], "&"}], "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"1", ",", "d"}], "]"}]}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "position", " ", "of", " ", "the", " ", "first", " ", "non"}], "-", 
         RowBox[{
         "zero", " ", "step", " ", "for", " ", "each", " ", "state"}]}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"o", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], "\[Equal]", "0"}], ",", 
            RowBox[{"Length", "[", "seq", "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}], "&"}], "/@", 
         "o"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"o", "=", 
        RowBox[{"GroupBy", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"#", ",", 
               RowBox[{"o", "[", 
                RowBox[{"[", "#", "]"}], "]"}], ",", 
               RowBox[{"ev", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"o", "[", 
                   RowBox[{"[", "#", "]"}], "]"}], ",", "#"}], "]"}], "]"}]}],
               "}"}], "]"}], "&"}], "/@", 
           RowBox[{"Range", "[", 
            RowBox[{"1", ",", "d"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "&"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "group", " ", "states", " ", "by", " ", "first", " ", "non"}], "-", 
         RowBox[{"zero", " ", "position"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"o", "=", 
        RowBox[{
         RowBox[{"ArrayFlatten", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sort", "[", 
              RowBox[{
               RowBox[{"o", "[", "i", "]"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"#1", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], ">", 
                 RowBox[{"#2", "[", 
                  RowBox[{"[", "3", "]"}], "]"}]}], "&"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Sort", "@", 
                RowBox[{"Keys", "[", "o", "]"}]}]}], "}"}]}], "]"}], ",", 
           "1"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "sort", " ", "states", " ", "within", " ", "groups", " ", "by", " ", 
         "decreasing", " ", "probability", " ", "and", " ", "get", " ", 
         "final", " ", "order"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"p", "=", 
        RowBox[{
         RowBox[{"IdentityMatrix", "[", "d", "]"}], "[", 
         RowBox[{"[", "o", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "construct", " ", "the", " ", "permutation", " ", "matrix", " ", 
         "that", " ", "reorders", " ", "states"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"p", ".", "#", ".", 
           RowBox[{"Transpose", "[", "p", "]"}]}], "&"}], ")"}], "/@", 
        "t0"}]}]}], " ", 
     RowBox[{"(*", " ", 
      RowBox[{
      "apply", " ", "the", " ", "permutation", " ", "for", " ", "T0", " ", 
       "and", " ", "T1", " ", "and", " ", "return", " ", "the", " ", 
       "reodered", " ", "state"}], " ", "*)"}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Exact", " ", "computation", " ", "based", " ", "on", " ", "the", " ", 
     RowBox[{"(", 
      RowBox[{"deterministic", " ", "steps"}], ")"}]}], "+", 
    RowBox[{
     RowBox[{"(", "cycle", ")"}], " ", "analysis"}]}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"We", " ", "assume", " ", "a", " ", "length", " ", "ldet"}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"0", ".."}], "L", " ", "for", " ", "the", " ", "deterministic",
        " ", "part", " ", "and", " ", "1"}], ".."}], 
     RowBox[{"(", 
      RowBox[{"L", "-", 
       RowBox[{"ldet", " ", "for", " ", "the", " ", "cycle"}]}], " "}]}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Whenever", " ", "we", " ", "find", " ", "a", " ", "better", " ", "bound",
      " ", "dc"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"we", " ", "collect", " ", "all", " ", "patterns", " ", 
       RowBox[{"(", 
        RowBox[{"ldet", ",", "lcy"}], ")"}], " ", "where", " ", "ldet"}], "+",
       "lcy"}], "=", "dc"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"We", " ", "stop", " ", "once", " ", "ldet"}], " ", ">", " ", 
     "dc"}], ",", " ", 
    RowBox[{
    "since", " ", "we", " ", "can", " ", "only", " ", "do", " ", "worse", " ",
      "after", " ", 
     RowBox[{"that", "."}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DCPatterns", "[", "seq_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "ldet", ",", "lcy", ",", "L", ",", "dc", ",", "patts", ",", "s"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"L", "=", 
        RowBox[{"Length", "[", "seq", "]"}]}], ";", 
       RowBox[{"dc", "=", "L"}], ";", 
       RowBox[{"patts", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"ldet", "=", "0"}], ",", 
         RowBox[{"ldet", "\[LessEqual]", "dc"}], ",", 
         RowBox[{"ldet", "++"}], ",", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"lcy", "=", "1"}], ",", 
           RowBox[{"lcy", "\[LessEqual]", 
            RowBox[{
             RowBox[{"Length", "[", "seq", "]"}], "-", "ldet"}]}], ",", 
           RowBox[{"lcy", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"s", "=", 
             RowBox[{"Take", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Take", "[", 
                   RowBox[{"seq", ",", "ldet"}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"ConstantArray", "[", 
                   RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{
                    RowBox[{"Drop", "[", 
                    RowBox[{"seq", ",", "ldet"}], "]"}], ",", "lcy"}], "]"}], 
                    ",", 
                    RowBox[{"Ceiling", "[", 
                    FractionBox[
                    RowBox[{"L", "-", "ldet"}], "lcy"], "]"}]}], "]"}]}], 
                 "\[IndentingNewLine]", "}"}], "]"}], ",", "L"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"seq", "\[Equal]", "s"}], "&&", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"ldet", "+", "lcy"}], ")"}], "\[LessEqual]", 
                "dc"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"ldet", "+", "lcy"}], ")"}], "<", "dc"}], ",", 
                 RowBox[{
                  RowBox[{"dc", "=", 
                   RowBox[{"ldet", "+", "lcy"}]}], ";", 
                  RowBox[{"patts", "=", 
                   RowBox[{"{", "}"}]}], ";"}]}], "]"}], ";", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"patts", ",", 
                 RowBox[{"{", 
                  RowBox[{"ldet", ",", "lcy"}], "}"}]}], "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"dc", ",", "patts"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Returns", " ", "the", " ", "string", " ", "version", " ", "of", " ", 
    "the", " ", 
    RowBox[{"patterns", ":", " ", 
     RowBox[{"00", 
      RowBox[{"(", "10", ")"}], " ", 
      RowBox[{"etc", "."}]}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DCExact", "[", "seq_", "]"}], ":=", 
   RowBox[{
    RowBox[{"DCPatterns", "[", "seq", "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DC", "[", "seq_", "]"}], ":=", 
   RowBox[{"DCExact", "[", "seq", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DCPatternStrings", "[", 
     RowBox[{"seq_", ",", 
      RowBox[{"aligned_", ":", "False"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"pats", ",", "p", ",", "ps", ",", "dc"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"dc", ",", "pats"}], "}"}], "=", 
        RowBox[{"DCPatterns", "[", "seq", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"aligned", ",", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"ps", "=", 
             RowBox[{"Flatten", "@", 
              RowBox[{"Join", "[", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"ConstantArray", "[", 
                   RowBox[{"\"\< \>\"", ",", "dc"}], "]"}], ",", 
                  RowBox[{"Map", "[", 
                   RowBox[{"ToString", ",", 
                    RowBox[{"Take", "[", 
                    RowBox[{"seq", ",", "dc"}], "]"}]}], "]"}]}], "}"}], 
                "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"ps", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"2", 
                 RowBox[{"p", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}], "+", "1"}], "]"}], "]"}], 
             "=", "\"\<(\>\""}], ";", 
            RowBox[{"ps", "<>", "\"\<)\>\""}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"p", ",", "pats"}], "}"}]}], "\[IndentingNewLine]", "]"}],
          ",", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Take", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"ToString", ",", "seq"}], "]"}], ",", 
              RowBox[{"p", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "<>", "\"\<(\>\"", "<>", 
            RowBox[{"Take", "[", 
             RowBox[{
              RowBox[{"Drop", "[", 
               RowBox[{
                RowBox[{"Map", "[", 
                 RowBox[{"ToString", ",", "seq"}], "]"}], ",", 
                RowBox[{"p", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
              RowBox[{"p", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "<>", "\"\<)\>\""}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"p", ",", "pats"}], "}"}]}], "\[IndentingNewLine]", 
          "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Generates", " ", "all", " ", "the", " ", "equivalent", " ", "DC", " ", 
    "models", " ", "for", " ", "a", " ", "given", " ", "sequence"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DCModels", "[", "seq_", "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "pats", ",", "d", ",", "m", ",", "p", ",", "pseq", ",", "pcy", ",", 
        "i"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"d", ",", "pats"}], "}"}], "=", 
        RowBox[{"DCPatterns", "[", "seq", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"m", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", 
             RowBox[{"{", 
              RowBox[{"2", ",", "d", ",", "d"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i", "=", "1"}], ",", 
            RowBox[{"i", "\[LessEqual]", 
             RowBox[{"d", "-", "1"}]}], ",", 
            RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"m", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"seq", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "+", "1"}], ",", "i", ",", 
                 RowBox[{"i", "+", "1"}]}], "]"}], "]"}], "=", "1"}], ";"}]}],
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"m", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{
               RowBox[{"seq", "[", 
                RowBox[{"[", "d", "]"}], "]"}], "+", "1"}], ",", "d", ",", 
              RowBox[{"d", "-", 
               RowBox[{"p", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", "1"}]}], "]"}], "]"}], 
           "=", "1"}], ";", "\[IndentingNewLine]", "m"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"p", ",", "pats"}], "}"}]}], "\[IndentingNewLine]", 
        "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Visualizes", " ", "the", " ", "sequence", " ", "as", " ", "a", " ", "row",
     " ", "of", " ", 
    RowBox[{"black", "/", "white"}], " ", "squares"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "The", " ", "optional", " ", "parameter", " ", "k", " ", "places", " ", 
     "a", " ", "red", " ", "line", " ", "after", " ", "the", " ", "k"}], "-", 
    RowBox[{"th", " ", "square"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ViewSequence", "[", 
     RowBox[{"seq_", ",", 
      RowBox[{"k_", ":", "0"}], ",", 
      RowBox[{"size_", ":", "100"}]}], "]"}], ":=", 
    RowBox[{"ArrayPlot", "[", 
     RowBox[{
      RowBox[{"{", "seq", "}"}], ",", 
      RowBox[{"ColorRules", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"0", "\[Rule]", 
          RowBox[{"Hue", "[", 
           RowBox[{"0", ",", "0", ",", "0.9"}], "]"}]}], ",", 
         RowBox[{"1", "\[Rule]", "Black"}]}], "}"}]}], ",", 
      RowBox[{"Mesh", "\[Rule]", "All"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Epilog", "\[Rule]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"k", "\[NotEqual]", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{"Red", ",", 
           RowBox[{"AbsoluteThickness", "[", "2", "]"}], ",", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"k", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"k", ",", "1"}], "}"}]}], "}"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"ImageSize", "\[Rule]", "size"}], ",", 
      RowBox[{"Frame", "\[Rule]", "None"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Typical", " ", "ArrayPlot"}], ",", " ", 
    RowBox[{
     RowBox[{"but", " ", "fixing", " ", "0"}], "=", 
     RowBox[{
      RowBox[{"white", " ", "1"}], "=", "black"}]}], ",", " ", 
    RowBox[{
    "without", " ", "automatic", " ", "normalization", " ", "of", " ", 
     "dataset"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NormalizedArrayPlot", "[", 
    RowBox[{"data_", ",", "opts___"}], "]"}], ":=", 
   RowBox[{"ArrayPlot", "[", 
    RowBox[{"data", ",", 
     RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
     RowBox[{"ColorFunction", "\[Rule]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Hue", "[", 
         RowBox[{"0", ",", "0", ",", 
          RowBox[{"1", "-", "#"}]}], "]"}], "&"}], ")"}]}], ",", "opts"}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Dag", "=", "ConjugateTranspose"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MatrixSqrt", "[", "x_", "]"}], ":=", 
    RowBox[{"MatrixPower", "[", 
     RowBox[{"x", ",", 
      RowBox[{"1", "/", "2"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ones", "[", "d_", "]"}], ":=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"1", ",", 
     RowBox[{"{", 
      RowBox[{"d", ",", "d"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GetRho", "[", "d_", "]"}], ":=", 
    RowBox[{"N", "@", 
     RowBox[{"Map", "[", 
      RowBox[{"KroneckerDelta", ",", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"i", " ", "j"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "d"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "d"}], "}"}]}], "]"}], "-", "1"}], ",", 
       RowBox[{"{", "2", "}"}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Compute", " ", "the", " ", "probability", " ", "given", " ", "a", " ", 
    "quantum", " ", "model"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Note", ":", " ", 
     RowBox[{
      RowBox[{
      "Because", " ", "stochastic", " ", "convention", " ", "is", " ", 
       "right"}], "-", 
      RowBox[{
      "multiplication", " ", "of", " ", "transition", " ", "matrices", " ", 
       "and", " ", "row", " ", "vectors"}]}]}], ",", " ", 
    RowBox[{
     RowBox[{
     "and", "\[IndentingNewLine]", "QM", " ", "uses", " ", "column", " ", 
      "vectors", " ", "and", " ", "left"}], "-", "multiplication"}], ",", " ", 
    RowBox[{
    "we", " ", "must", " ", "ensure", " ", "we", " ", "reverse", " ", "the", 
     " ", 
     RowBox[{"sequence", "."}]}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ComputeQuantumProbability", "[", 
    RowBox[{"t_", ",", "seq_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Abs", "@", 
      RowBox[{"Tr", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"#", ".", 
           RowBox[{"GetRho", "[", 
            RowBox[{
             RowBox[{"Dimensions", "[", "t", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "]"}], ".", 
           RowBox[{"Dag", "[", "#", "]"}]}], ")"}], "&"}], "@", 
        RowBox[{"(", 
         RowBox[{"Dot", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"Reverse", "@", "seq"}], "+", "1"}], "]"}], "]"}]}], 
         ")"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ComputeQuantumState", "[", 
     RowBox[{"t_", ",", "seq_", ",", 
      RowBox[{"trunc_", ":", 
       RowBox[{"-", "1"}]}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"#", ".", 
          RowBox[{"GetRho", "[", 
           RowBox[{
            RowBox[{"Dimensions", "[", "t", "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}], ".", 
          RowBox[{"Dag", "[", "#", "]"}]}], ")"}], "&"}], "@", 
       RowBox[{"(", 
        RowBox[{"Dot", "@@", 
         RowBox[{"t", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"Reverse", "@", 
             RowBox[{"Take", "[", 
              RowBox[{"seq", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"trunc", "<", "0"}], ",", 
                 RowBox[{"Length", "[", "seq", "]"}], ",", "trunc"}], "]"}]}],
               "]"}]}], "+", "1"}], "]"}], "]"}]}], ")"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Visualize", " ", "complex", " ", "matrices", " ", "using", " ", "domain", 
    " ", "coloring"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "ViewComplexMatrix", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ViewComplexMatrix", "[", 
     RowBox[{"m_", ",", "opts___"}], "]"}], ":=", 
    RowBox[{"ArrayPlot", "[", 
     RowBox[{"m", ",", "\[IndentingNewLine]", 
      RowBox[{"ColorFunction", "\[Rule]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Hue", "[", 
          RowBox[{
           FractionBox[
            RowBox[{"N", "@", 
             RowBox[{"Arg", "[", "#", "]"}]}], 
            RowBox[{"2", "Pi"}]], ",", 
           SuperscriptBox[
            RowBox[{"Round", "[", 
             RowBox[{
              RowBox[{"Abs", "[", "#", "]"}], ",", "0.01"}], "]"}], "2"], ",",
            "1"}], "]"}], "&"}], ")"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"Mesh", "\[Rule]", "All"}], ",", "\[IndentingNewLine]", 
      RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
      "\[IndentingNewLine]", "opts"}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PolarDecompositionUP", "[", "m_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"w", ",", "s", ",", "v"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"w", ",", "s", ",", "v"}], "}"}], "=", 
       RowBox[{"SingularValueDecomposition", "[", "m", "]"}]}], ";", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"w", ".", 
         RowBox[{"ConjugateTranspose", "[", "v", "]"}]}], ",", 
        RowBox[{"v", ".", "s", ".", 
         RowBox[{"ConjugateTranspose", "[", "v", "]"}]}]}], "}"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolarDecomposition", "=", "PolarDecompositionUP"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PolarDecompositionPU", "[", "m_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"w", ",", "s", ",", "v"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"w", ",", "s", ",", "v"}], "}"}], "=", 
        RowBox[{"SingularValueDecomposition", "[", "m", "]"}]}], ";", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"w", ".", "s", ".", 
          RowBox[{"ConjugateTranspose", "[", "w", "]"}]}], ",", 
         RowBox[{"w", ".", 
          RowBox[{"ConjugateTranspose", "[", "v", "]"}]}]}], "}"}]}]}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Eij", "[", 
    RowBox[{"d_", ",", "i_", ",", "j_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Transpose", "[", 
     RowBox[{"{", 
      RowBox[{"Map", "[", 
       RowBox[{"KroneckerDelta", ",", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"1", ",", "d"}], "]"}], "-", "i"}]}], "]"}], "}"}], "]"}], 
    ".", 
    RowBox[{"{", 
     RowBox[{"Map", "[", 
      RowBox[{"KroneckerDelta", ",", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"1", ",", "d"}], "]"}], "-", "j"}]}], "]"}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TrE", "[", 
    RowBox[{"m_", ",", "d_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ds", ",", "de", ",", "i", ",", "j"}], "}"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ds", ",", "de"}], "}"}], "=", "d"}], ";", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Tr", "[", 
         RowBox[{"m", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{
             RowBox[{"1", "+", 
              RowBox[{"i", " ", "de"}]}], ";;", 
             RowBox[{
              RowBox[{"i", " ", "de"}], "+", "de"}]}], ",", 
            RowBox[{
             RowBox[{"1", "+", 
              RowBox[{"j", " ", "de"}]}], ";;", 
             RowBox[{
              RowBox[{"j", " ", "de"}], "+", "de"}]}]}], "]"}], "]"}], "]"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "0", ",", 
          RowBox[{"ds", "-", "1"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "0", ",", 
          RowBox[{"ds", "-", "1"}]}], "}"}]}], "]"}]}]}], "]"}]}], 
  ";"}]}], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.},
 InitializationCell->True,
 CellChangeTimes->{
  3.807467145884859*^9, {3.807467232671051*^9, 3.807467310109232*^9}, {
   3.807467358867917*^9, 3.807467415064949*^9}, {3.807467446352857*^9, 
   3.8074677759507236`*^9}, {3.8074680876974893`*^9, 
   3.8074681513355827`*^9}, {3.8074682180281982`*^9, 
   3.8074685110994873`*^9}, {3.8074685888564587`*^9, 
   3.8074686183336115`*^9}, {3.8074686576999407`*^9, 3.807468665152344*^9}, {
   3.807468743718423*^9, 3.8074687745195255`*^9}, {3.807468819373335*^9, 
   3.8074689427780952`*^9}, {3.807469094860321*^9, 3.8074691017019043`*^9}, {
   3.807469367080814*^9, 3.807469429545165*^9}, {3.807469471262864*^9, 
   3.8074697566627817`*^9}, {3.8074698434544616`*^9, 
   3.8074698974214716`*^9}, {3.8074699313923836`*^9, 
   3.8074699699587045`*^9}, {3.807470040080634*^9, 3.8074700422372293`*^9}, {
   3.8074702232288065`*^9, 3.8074702247177105`*^9}, {3.80747032120427*^9, 
   3.807470373701479*^9}, {3.80759660022458*^9, 3.8075966107200727`*^9}, {
   3.8075966476004477`*^9, 3.807596665715925*^9}, {3.807596783808707*^9, 
   3.8075967906399727`*^9}, {3.807596921200232*^9, 3.8075969551197*^9}, {
   3.807596988671455*^9, 3.807597012799436*^9}, {3.807597088318613*^9, 
   3.807597149694099*^9}, {3.807597226057543*^9, 3.8075972780618553`*^9}, 
   3.807597401120393*^9, {3.807600645585371*^9, 3.807600694112997*^9}, 
   3.8076007434111443`*^9, {3.807855028174852*^9, 3.807855031970052*^9}, {
   3.807871299789085*^9, 3.8078713277528143`*^9}, 3.807875317003551*^9, {
   3.807942723979377*^9, 3.807942724231127*^9}, 3.8079436283921757`*^9, {
   3.807949370897731*^9, 3.807949515330797*^9}, {3.807949554518256*^9, 
   3.8079499206778812`*^9}, {3.80795224218679*^9, 3.807952242588191*^9}, 
   3.8079524201590433`*^9, {3.807955556000428*^9, 3.807955577773745*^9}, 
   3.8080391330108633`*^9, {3.8080664591817074`*^9, 3.8080664592626953`*^9}, {
   3.808080657381915*^9, 3.8080806575378213`*^9}, {3.8080837137729588`*^9, 
   3.8080837140355663`*^9}, {3.8087705962832565`*^9, 3.808770675093821*^9}, {
   3.8098862393414106`*^9, 3.8098862724466515`*^9}, {3.809891403241506*^9, 
   3.8098914060742407`*^9}, {3.809949306560156*^9, 3.809949312101409*^9}, {
   3.813062215778658*^9, 3.8130622431969976`*^9}, {3.813062594414989*^9, 
   3.813062612497328*^9}, {3.8133983476747026`*^9, 3.81339837907712*^9}, {
   3.813964837540311*^9, 3.8139649511217833`*^9}, {3.8139650536032686`*^9, 
   3.8139650643814764`*^9}, {3.813965111268342*^9, 3.8139652672087994`*^9}, {
   3.813965311024686*^9, 3.8139653448973894`*^9}, {3.8139717847932653`*^9, 
   3.813971785211036*^9}, {3.814001477973439*^9, 3.814001489692132*^9}, {
   3.8140583198388834`*^9, 3.8140583323516655`*^9}, {3.814133245119357*^9, 
   3.814133317992733*^9}, {3.814190404111297*^9, 3.814190404501044*^9}, {
   3.8142159323124304`*^9, 3.8142159325732813`*^9}, {3.814259135274123*^9, 
   3.814259285134672*^9}, {3.8143009798135147`*^9, 3.814300980037401*^9}, {
   3.814301081274012*^9, 3.814301087134616*^9}, {3.8147461324427137`*^9, 
   3.8147461669250164`*^9}, {3.814938075383336*^9, 3.8149381169893384`*^9}, {
   3.815292093243273*^9, 3.815292179625064*^9}, {3.8170772099855356`*^9, 
   3.817077240424503*^9}, {3.8171885992384634`*^9, 3.817188601786152*^9}, {
   3.8171886672901897`*^9, 3.817188668941828*^9}, {3.817191640918845*^9, 
   3.817191654424842*^9}, {3.8243415512232466`*^9, 3.824341704127593*^9}, 
   3.824341973184808*^9, {3.824858526784916*^9, 3.8248585295837545`*^9}, {
   3.8267930308234377`*^9, 
   3.8267930354423122`*^9}},ExpressionUUID->"e7219da5-f3d8-4dae-a534-\
e0d762249d7d"]
}, Open  ]],

Cell["", "PageBreak",
 PageBreakBelow->True,ExpressionUUID->"bb760470-614b-45bd-a2fe-fba53c2784f6"],

Cell[CellGroupData[{

Cell["Quantum Model #2 (fullspace Fourier)", "Section",
 CellChangeTimes->{{3.813965362013778*^9, 3.8139653649706254`*^9}, 
   3.813970328500845*^9, {3.8140015748581*^9, 
   3.814001579513683*^9}},ExpressionUUID->"1e4b6025-1432-40d5-bee7-\
398cde2ea0dd"],

Cell[TextData[{
 "This approach also uses ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Eta]", "a"], TraditionalForm]],ExpressionUUID->
  "bb6f0e5a-b6e1-4322-95d9-e8e85a638025"],
 ", but we don't separate the spaces. We just apply the Fourier transform in \
the entire space directly.\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["H", "a"], "=", 
    RowBox[{"F", " ", 
     RowBox[{"(", " ", 
      RowBox[{
       UnderoverscriptBox[
        RowBox[{" ", "\[Sum]"}], 
        RowBox[{"k", "=", "1"}], 
        RowBox[{"|", "a", "|"}]], 
       TemplateBox[{"k"},
        "Ket"], 
       TemplateBox[{"k"},
        "Bra"]}], ")"}], 
     SuperscriptBox["F", "\[Dagger]"]}]}], TraditionalForm]],
  InitializationCell->True,ExpressionUUID->
  "58b2d667-b083-469e-a5f7-e8cdd8a92467"],
 "\nthen proceed as normal\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["U", "a"], "=", 
    SuperscriptBox["\[ExponentialE]", 
     RowBox[{"\[ImaginaryI]", " ", 
      SubscriptBox["H", "a"], 
      SubscriptBox["\[Theta]", "a"]}]]}], TraditionalForm]],ExpressionUUID->
  "78909084-8e57-438d-bc0a-2bdc59b31446"],
 "\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["K", "a"], "=", 
    RowBox[{
     SubscriptBox["U", "a"], " ", 
     SqrtBox[
      RowBox[{"diag", "(", 
       SubscriptBox["\[Eta]", "a"], ")"}]]}]}], TraditionalForm]],
  ExpressionUUID->"2a57071e-f7af-4940-a47f-cc2434ec02f6"]
}], "Text",
 CellChangeTimes->{{3.813970332053773*^9, 3.813970387937557*^9}, {
  3.813970539399181*^9, 
  3.8139705722452374`*^9}},ExpressionUUID->"de494ca3-dafb-435e-916a-\
36556eba3748"],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuantumModel2GetModel", "[", 
   RowBox[{"ct_", ",", "\[Theta]0_", ",", "\[Theta]1_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"d", ",", "h", ",", "e0", ",", "e1"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"d", "=", 
      RowBox[{
       RowBox[{"Dimensions", "[", "ct", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"e0", ",", "e1"}], "}"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"#", ".", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"1", ",", 
            RowBox[{"{", 
             RowBox[{"d", ",", "1"}], "}"}]}], "]"}]}], "]"}], "&"}], "/@", 
       "ct"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"h", "=", 
      RowBox[{
       RowBox[{"N", "[", 
        RowBox[{"FourierMatrix", "[", "d", "]"}], "]"}], ".", 
       RowBox[{"N", "[", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{"N", "@", 
          RowBox[{"Range", "[", 
           RowBox[{"1", ",", "d"}], "]"}]}], "]"}], "]"}], ".", 
       RowBox[{"ConjugateTranspose", "[", 
        RowBox[{"N", "[", 
         RowBox[{"FourierMatrix", "[", "d", "]"}], "]"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixExp", "[", 
         RowBox[{"\[ImaginaryI]", " ", "h", " ", "\[Theta]0"}], "]"}], ".", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{"Sqrt", "@", "e0"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"MatrixExp", "[", 
         RowBox[{"\[ImaginaryI]", " ", "h", " ", "\[Theta]1"}], "]"}], ".", 
        RowBox[{"DiagonalMatrix", "[", 
         RowBox[{"Sqrt", "@", 
          RowBox[{"(", 
           RowBox[{"1", "-", "e0"}], ")"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.8139705977245445`*^9, {3.813970750687059*^9, 3.8139708218385787`*^9}, {
   3.8139710818523216`*^9, 3.8139710977015276`*^9}, {3.8139711568646955`*^9, 
   3.813971162462594*^9}, {3.813976112597565*^9, 3.8139761705523643`*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"e16a71bd-1b2c-460f-84b0-dcd6b5b259a6"],

Cell["", "PageBreak",
 PageBreakBelow->True,ExpressionUUID->"a8719cb5-d022-443f-909c-3936c7c2b5f9"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Quantum Fourier models (#1 and #2)", "Section",
 CellChangeTimes->{{3.8140026706210203`*^9, 
  3.8140026846589394`*^9}},ExpressionUUID->"177e24d2-33ad-4c8a-8589-\
04d200f8352c"],

Cell[TextData[{
 "Here we run an optimization over the two of the above models for all \
sequences and relevant dimensions (",
 Cell[BoxData[
  FormBox[
   RowBox[{"d", "\[LessEqual]", " ", 
    RowBox[{"DC", "(", 
     StyleBox["a",
      FontWeight->"Bold"], ")"}]}], TraditionalForm]],ExpressionUUID->
  "24857ac9-fd27-4067-9688-d285ad427430"],
 "),\[LineSeparator]so we may compare the results."
}], "Text",
 CellChangeTimes->{{3.81397198151859*^9, 3.8139720009044085`*^9}, {
   3.81397229352171*^9, 3.8139723263636627`*^9}, {3.813973201925572*^9, 
   3.8139733205061464`*^9}, 
   3.8140014646336365`*^9},ExpressionUUID->"43849285-caa4-4f4c-b9af-\
0ccee4dbbd9d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"LM", "=", "10"}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"maximum", " ", "L", " ", "to", " ", "go", " ", "to"}], " ", 
   "*)"}], "\[IndentingNewLine]", "\[LineSeparator]", 
  RowBox[{"(*", " ", 
   RowBox[{"Setup", " ", "paths"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"path2", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], ",", "\"\<surveydata\>\"", 
      ",", "\"\<quantummodel2\>\""}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"!", 
      RowBox[{"FileExistsQ", "[", "path2", "]"}]}], ",", 
     RowBox[{"CreateDirectory", "[", "path2", "]"}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"If", "[", 
  RowBox[{"False", ",", 
   RowBox[{"(*", " ", 
    RowBox[{"prevent", " ", "executing", " ", 
     RowBox[{"again", "!"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Get", " ", "all", " ", "models", " ", "beforehand"}], ",", " ", 
     RowBox[{"since", " ", "we", " ", 
      RowBox[{"can", "'"}], "t", " ", "use", " ", "ImportTModel", " ", "in", 
      " ", "ParallelTable"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ctmodels", "=", 
     RowBox[{"Association", "@@", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"L", "\[Rule]", 
         RowBox[{"Association", "@@", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"seq", "\[Rule]", 
             RowBox[{"Association", "@@", 
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"d", "\[Rule]", 
                 RowBox[{"Round", "[", 
                  RowBox[{
                   RowBox[{"CanonicalOrder", "[", 
                    RowBox[{
                    RowBox[{"ImportTModel", "[", 
                    RowBox[{"seq", ",", "d"}], "]"}], ",", "seq"}], "]"}], 
                   ",", 
                   SuperscriptBox["10.0", 
                    RowBox[{"-", "4"}]]}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"d", ",", "1", ",", 
                  RowBox[{"DC", "[", "seq", "]"}]}], "}"}]}], 
               "\[IndentingNewLine]", "]"}]}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"seq", ",", 
              RowBox[{"IntegerDigits", "[", 
               RowBox[{
                RowBox[{"Range", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{
                   SuperscriptBox["2", 
                    RowBox[{"L", "-", "1"}]], "-", "1"}]}], "]"}], ",", "2", 
                ",", "L"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", 
           "]"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"L", ",", "3", ",", "LM"}], "}"}]}], "\[IndentingNewLine]", 
       "]"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Do", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"res", "=", 
          RowBox[{"ParallelTable", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"dc", "=", 
              RowBox[{"DC", "[", "seq", "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"ct", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"ctmodels", "[", "L", "]"}], "[", "seq", "]"}], "[", 
               RowBox[{"Min", "[", 
                RowBox[{"dc", ",", "d"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"qt2", "=", 
              RowBox[{"QuantumModel2GetModel", "[", 
               RowBox[{"ct", ",", "\[Theta]0", ",", "\[Theta]1"}], "]"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
              "seq", ",", "d", ",", "\[IndentingNewLine]", "Null", ",", " ", 
               RowBox[{"(*", " ", 
                RowBox[{"old", " ", "quantum", " ", "model", " ", "that", " ", 
                 RowBox[{"didn", "'"}], "t", " ", "work"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"d", ">", "dc"}], ",", "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\[Theta]0", "\[Rule]", "0"}], ",", 
                    RowBox[{"\[Theta]1", "\[Rule]", "0"}]}], "}"}]}], "}"}], 
                 ",", "\[IndentingNewLine]", 
                 RowBox[{"NMaximize", "[", 
                  RowBox[{
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"ComputeQuantumProbability", "[", 
                    RowBox[{"qt2", ",", "seq"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"-", "Pi"}], "\[LessEqual]", "\[Theta]0", 
                    "\[LessEqual]", "Pi"}], ",", 
                    RowBox[{
                    RowBox[{"-", "Pi"}], "\[LessEqual]", "\[Theta]1", 
                    "\[LessEqual]", "Pi"}]}], "\[IndentingNewLine]", "}"}], 
                   ",", "\[IndentingNewLine]", 
                   RowBox[{"{", 
                    RowBox[{"\[Theta]0", ",", "\[Theta]1"}], "}"}]}], 
                  "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
                "]"}]}], "\[IndentingNewLine]", "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"seq", ",", 
              RowBox[{"IntegerDigits", "[", 
               RowBox[{
                RowBox[{"Range", "[", 
                 RowBox[{"1", ",", 
                  RowBox[{
                   SuperscriptBox["2", 
                    RowBox[{"L", "-", "1"}]], "-", "1"}]}], "]"}], ",", "2", 
                ",", "L"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "@", 
          RowBox[{"Export", "[", 
           RowBox[{
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{"path2", ",", 
               RowBox[{"\"\<L\>\"", "<>", 
                RowBox[{"ToString", "[", "L", "]"}], "<>", "\"\<_d\>\"", "<>", 
                RowBox[{"ToString", "[", "d", "]"}], "<>", "\"\<.mx\>\""}]}], 
              "}"}], "]"}], ",", 
            RowBox[{"res", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2", ",", "4"}], "}"}]}], "]"}], "]"}]}], 
           "]"}]}], ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"d", ",", "2", ",", "L"}], "}"}]}], "\[IndentingNewLine]", 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"L", ",", "3", ",", "LM"}], "}"}]}], "\[IndentingNewLine]", 
     "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "Input",
 Evaluatable->False,
 CellChangeTimes->{{3.813972019897438*^9, 3.8139721579398203`*^9}, {
   3.8139721941752634`*^9, 3.813972289261018*^9}, {3.8139723447970147`*^9, 
   3.813972374050143*^9}, {3.813972447399743*^9, 3.81397245026068*^9}, {
   3.813972502859807*^9, 3.8139725751124644`*^9}, {3.8139726175235176`*^9, 
   3.813972629101205*^9}, 3.8139728182533846`*^9, {3.813973497796289*^9, 
   3.8139735792196436`*^9}, {3.813973657047326*^9, 3.8139740863397884`*^9}, {
   3.8139742652386723`*^9, 3.813974316174361*^9}, {3.8139743768446193`*^9, 
   3.8139744787549295`*^9}, {3.81397453588888*^9, 3.8139746055282774`*^9}, {
   3.8139746764727783`*^9, 3.813974745048171*^9}, {3.8139747946437244`*^9, 
   3.8139751060208197`*^9}, {3.8139751661451406`*^9, 
   3.8139751879225817`*^9}, {3.8139759612610283`*^9, 
   3.8139759778065023`*^9}, {3.813976290920439*^9, 3.8139763025320005`*^9}, {
   3.813976363521085*^9, 3.8139765325611367`*^9}, {3.813976587505577*^9, 
   3.813976748999809*^9}, {3.8139768399004507`*^9, 3.813976913604403*^9}, {
   3.813976950096363*^9, 3.8139770537659593`*^9}, {3.8139773166413145`*^9, 
   3.8139773778978806`*^9}, {3.813977424212661*^9, 3.8139775617107983`*^9}, {
   3.8139776559975805`*^9, 3.8139777019276333`*^9}, {3.8139777460228357`*^9, 
   3.8139780166684947`*^9}, {3.813978091538698*^9, 3.813978189715852*^9}, {
   3.813978240842766*^9, 3.813978259471298*^9}, {3.8139783705118694`*^9, 
   3.813978370894657*^9}, {3.8139784065374403`*^9, 3.813978424593763*^9}, {
   3.8139785508355584`*^9, 3.8139785542222223`*^9}, {3.813998670942031*^9, 
   3.81399868837996*^9}, {3.8140010370211697`*^9, 3.814001037284018*^9}, {
   3.8140025972283516`*^9, 3.8140026038645344`*^9}, {3.814002638879328*^9, 
   3.814002640434432*^9}, {3.814058357568123*^9, 3.81405836098715*^9}, {
   3.8267931019678535`*^9, 3.8267931129517584`*^9}, {3.8267931587757387`*^9, 
   3.826793194632931*^9}},ExpressionUUID->"dbd4641a-3adb-43ae-b289-\
f3d027f47a90"],

Cell[" ", "Text",
 Editable->False,
 Selectable->False,
 CellFrame->{{0, 0}, {0, 3}},
 ShowCellBracket->False,
 CellMargins->{{0, 0}, {1, 1}},
 CellElementSpacings->{"CellMinHeight"->1},
 CellFrameMargins->0,
 CellFrameColor->RGBColor[0, 0, 1],
 CellSize->{
  Inherited, 5},ExpressionUUID->"06a43a18-db72-4b22-839e-2ff409c0930d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ctmodels", "=", 
   RowBox[{"Association", "@@", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"L", "\[Rule]", 
       RowBox[{"Association", "@@", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"seq", "\[Rule]", 
           RowBox[{"Association", "@@", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"d", "\[Rule]", 
               RowBox[{"Round", "[", 
                RowBox[{
                 RowBox[{"CanonicalOrder", "[", 
                  RowBox[{
                   RowBox[{"ImportTModel", "[", 
                    RowBox[{"seq", ",", "d"}], "]"}], ",", "seq"}], "]"}], 
                 ",", 
                 SuperscriptBox["10.0", 
                  RowBox[{"-", "4"}]]}], "]"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"d", ",", "1", ",", 
                RowBox[{"DC", "[", "seq", "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "]"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"seq", ",", 
            RowBox[{"IntegerDigits", "[", 
             RowBox[{
              RowBox[{"Range", "[", 
               RowBox[{"0", ",", 
                RowBox[{
                 SuperscriptBox["2", 
                  RowBox[{"L", "-", "1"}]], "-", "1"}]}], "]"}], ",", "2", 
              ",", "L"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}]}]}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"L", ",", "3", ",", "8"}], "}"}]}], "\[IndentingNewLine]", 
     "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8245054220858965`*^9, 3.824505455198544*^9}},
 CellLabel->
  "In[1265]:=",ExpressionUUID->"ccefda06-12ab-4636-bc24-a171d32af7d9"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"qres", "=", 
   RowBox[{"Association", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dynamic", "[", "seq", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Dynamic", "[", "qres", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fn", "=", 
   RowBox[{
    RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
    "\"\<quantumopts.mx\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"FileExistsQ", "[", "fn", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"qres", "=", 
      RowBox[{"Import", "[", "fn", "]"}]}], ";"}], "\[IndentingNewLine]", ",",
     "\[IndentingNewLine]", 
    RowBox[{"Do", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"qres", "[", "L", "]"}], "=", 
        RowBox[{"Association", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"dc", "=", 
           RowBox[{"DC", "[", "seq", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"d", "=", 
           RowBox[{"dc", "-", "1"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ct", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"ctmodels", "[", "L", "]"}], "[", "seq", "]"}], "[", 
            RowBox[{"Min", "[", 
             RowBox[{"dc", ",", "d"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"qt2", "=", 
           RowBox[{"QuantumModel2GetModel", "[", 
            RowBox[{"ct", ",", "\[Theta]0", ",", "\[Theta]1"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"qres", "[", "L", "]"}], "[", "seq", "]"}], "=", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"seq", ",", "d", ",", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"d", ">", "dc"}], ",", "\[IndentingNewLine]", "1", ",",
                "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"NMaximize", "[", 
                   RowBox[{
                    RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"ComputeQuantumProbability", "[", 
                    RowBox[{"qt2", ",", "seq"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"-", "Pi"}], "\[LessEqual]", "\[Theta]0", 
                    "\[LessEqual]", "Pi"}], ",", 
                    RowBox[{
                    RowBox[{"-", "Pi"}], "\[LessEqual]", "\[Theta]1", 
                    "\[LessEqual]", "Pi"}]}], "\[IndentingNewLine]", "}"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"{", 
                    RowBox[{"\[Theta]0", ",", "\[Theta]1"}], "}"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Method", "\[Rule]", "#"}]}], 
                   "\[IndentingNewLine]", "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", 
                RowBox[{"{", 
                 RowBox[{
                 "\"\<DifferentialEvolution\>\"", ",", "\"\<NelderMead\>\"", 
                  ",", "\"\<SimulatedAnnealing\>\""}], "}"}]}]}], 
              "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Export", "[", 
           RowBox[{"fn", ",", "qres"}], "]"}], ";"}], "\[IndentingNewLine]", 
         ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"seq", ",", 
           RowBox[{"IntegerDigits", "[", 
            RowBox[{
             RowBox[{"Range", "[", 
              RowBox[{"1", ",", 
               RowBox[{
                SuperscriptBox["2", 
                 RowBox[{"L", "-", "1"}]], "-", "1"}]}], "]"}], ",", "2", ",",
              "L"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
      "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"L", ",", "3", ",", "10"}], "}"}]}], "\[IndentingNewLine]", 
     "]"}]}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.8245054814112787`*^9, 3.8245057806351023`*^9}, {
  3.8245058323550277`*^9, 3.8245058994173913`*^9}, {3.8245059484674945`*^9, 
  3.824506018842287*^9}, {3.8245060866452265`*^9, 3.8245061279985495`*^9}, {
  3.8248547836201816`*^9, 
  3.824854826803155*^9}},ExpressionUUID->"b399b150-34e2-49f4-93c1-\
9ac9097dd75b"],

Cell[BoxData[
 DynamicBox[ToBoxes[$CellContext`seq, StandardForm],
  ImageSizeCache->{279., {5., 16.}}]], "Output",
 CellChangeTimes->{{3.824505546332467*^9, 3.8245056428995647`*^9}, 
   3.824505676750041*^9, {3.824505706915349*^9, 3.8245057426908917`*^9}, 
   3.824505803833906*^9, {3.8245058623245535`*^9, 3.824505864059821*^9}, {
   3.8245059241379433`*^9, 3.8245059488911896`*^9}, 3.8245059798024516`*^9, {
   3.8245060155097337`*^9, 3.8245060191535254`*^9}, 3.8245060528015375`*^9, {
   3.824506093578607*^9, 3.824506129096656*^9}},
 CellLabel->
  "Out[226]=",ExpressionUUID->"8eaa305e-6f7f-41c2-a1cb-ba140e80d89b"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"oqms", "=", 
   RowBox[{"Import", "[", 
    RowBox[{
     RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
     "\"\<quantumopts.mx\>\""}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8248542300777197`*^9, 3.8248542384775324`*^9}, {
  3.824854271934599*^9, 3.8248542736927853`*^9}},
 CellLabel->
  "In[1259]:=",ExpressionUUID->"952dd978-65a9-4f7c-81f7-e2b8df15654a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"oqms", "[", "6", "]"}], "[", 
  RowBox[{"ClockSequence", "[", "6", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.824854275384617*^9, 3.8248543052525444`*^9}},
 CellLabel->
  "In[1266]:=",ExpressionUUID->"79cd2596-e39b-4be2-bf47-2a3d92bd5ab7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "1"}], "}"}], 
   ",", "5", ",", 
   RowBox[{"{", 
    RowBox[{
    "0.6537961554199683`", ",", "0.6537961554199679`", ",", 
     "0.6537961554199665`"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.824854277515999*^9, 3.824854305548377*^9}, 
   3.8248548324388504`*^9},
 CellLabel->
  "Out[1266]=",ExpressionUUID->"ba41e842-a4da-4b5b-af70-d4c33aa4cd50"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"QuantumModel2GetModel", "[", 
  RowBox[{"ct", ",", "\[Theta]0", ",", "\[Theta]1"}], "]"}]], "Input",Expressi\
onUUID->"93a1fb10-d6bf-49c6-949f-271d426fc17d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"L", "=", "6"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ct", "=", 
   RowBox[{
    RowBox[{"GeneralizedMulticyclicModel", "[", 
     RowBox[{
      RowBox[{"ConstantArray", "[", 
       RowBox[{"1", ",", 
        RowBox[{"L", "-", "1"}]}], "]"}], ",", "q"}], "]"}], "/.", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"#", "\[Rule]", " ", 
         FractionBox["1.0", "L"]}], "&"}], ")"}], "/@", 
      RowBox[{"Array", "[", 
       RowBox[{"q", ",", 
        RowBox[{"L", "-", "1"}]}], "]"}]}], ")"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"qt", "=", 
   RowBox[{"QuantumModel2GetModel", "[", 
    RowBox[{"ct", ",", "\[Theta]0", ",", "\[Theta]1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"f", "=", 
   RowBox[{"ComputeQuantumProbability", "[", 
    RowBox[{"qt", ",", 
     RowBox[{"ClockSequence", "[", "L", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Join", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"ComputeProbability", "[", 
     RowBox[{"ct", ",", 
      RowBox[{"ClockSequence", "[", "L", "]"}]}], "]"}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"NMaximize", "[", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{"f", ",", "\[IndentingNewLine]", 
       RowBox[{"0", "\[LessEqual]", "\[Theta]0", "\[LessEqual]", 
        RowBox[{"2", "Pi"}]}], ",", 
       RowBox[{"0", "\[LessEqual]", "\[Theta]1", "\[LessEqual]", 
        RowBox[{"2", " ", "Pi"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"\[Theta]0", ",", "\[Theta]1"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Method", "\[Rule]", "\"\<DifferentialEvolution\>\""}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8248550160489187`*^9, 3.824855332490059*^9}, {
  3.8248553945267925`*^9, 3.824855494847827*^9}},
 CellLabel->
  "In[1375]:=",ExpressionUUID->"64127411-b911-47e2-a332-ae163cdf0b81"]
}, Open  ]]
},
WindowSize->{1920, 997},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
Magnification:>1.4 Inherited,
FrontEndVersion->"12.1 for Microsoft Windows (64-bit) (June 19, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"2092024c-c53f-4b02-bc1c-db8e0ba58b8a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 315, 6, 93, "Subsection",ExpressionUUID->"1a9ea465-87d2-4182-9479-db041d969011",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.},
 InitializationCell->True],
Cell[898, 30, 54460, 1364, 6832, "Input",ExpressionUUID->"e7219da5-f3d8-4dae-a534-e0d762249d7d",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.},
 InitializationCell->True]
}, Open  ]],
Cell[55373, 1397, 99, 1, 6, "PageBreak",ExpressionUUID->"bb760470-614b-45bd-a2fe-fba53c2784f6",
 PageBreakBelow->True],
Cell[CellGroupData[{
Cell[55497, 1402, 254, 4, 116, "Section",ExpressionUUID->"1e4b6025-1432-40d5-bee7-398cde2ea0dd"],
Cell[55754, 1408, 1616, 51, 256, "Text",ExpressionUUID->"de494ca3-dafb-435e-916a-36556eba3748"],
Cell[57373, 1461, 2370, 60, 351, "Input",ExpressionUUID->"e16a71bd-1b2c-460f-84b0-dcd6b5b259a6",
 InitializationCell->True],
Cell[59746, 1523, 99, 1, 6, "PageBreak",ExpressionUUID->"a8719cb5-d022-443f-909c-3936c7c2b5f9",
 PageBreakBelow->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[59882, 1529, 183, 3, 116, "Section",ExpressionUUID->"177e24d2-33ad-4c8a-8589-04d200f8352c"],
Cell[60068, 1534, 666, 16, 98, "Text",ExpressionUUID->"43849285-caa4-4f4c-b9af-0ccee4dbbd9d"],
Cell[60737, 1552, 9219, 196, 1672, "Input",ExpressionUUID->"dbd4641a-3adb-43ae-b289-f3d027f47a90",
 Evaluatable->False],
Cell[69959, 1750, 329, 10, 17, "Text",ExpressionUUID->"06a43a18-db72-4b22-839e-2ff409c0930d"],
Cell[70291, 1762, 1826, 44, 398, "Input",ExpressionUUID->"ccefda06-12ab-4636-bc24-a171d32af7d9"],
Cell[CellGroupData[{
Cell[72142, 1810, 4566, 104, 1207, "Input",ExpressionUUID->"b399b150-34e2-49f4-93c1-9ac9097dd75b"],
Cell[76711, 1916, 620, 10, 57, "Output",ExpressionUUID->"8eaa305e-6f7f-41c2-a1cb-ba140e80d89b"]
}, Open  ]],
Cell[77346, 1929, 404, 10, 50, "Input",ExpressionUUID->"952dd978-65a9-4f7c-81f7-e2b8df15654a"],
Cell[CellGroupData[{
Cell[77775, 1943, 277, 6, 50, "Input",ExpressionUUID->"79cd2596-e39b-4be2-bf47-2a3d92bd5ab7"],
Cell[78055, 1951, 478, 13, 57, "Output",ExpressionUUID->"ba41e842-a4da-4b5b-af70-d4c33aa4cd50"]
}, Open  ]],
Cell[78548, 1967, 181, 3, 50, "Input",ExpressionUUID->"93a1fb10-d6bf-49c6-949f-271d426fc17d"],
Cell[78732, 1972, 2097, 57, 527, "Input",ExpressionUUID->"64127411-b911-47e2-a332-ae163cdf0b81"]
}, Open  ]]
}
]
*)

